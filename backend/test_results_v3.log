============================= test session starts ==============================
platform darwin -- Python 3.14.0, pytest-8.0.2, pluggy-1.6.0 -- /Library/Frameworks/Python.framework/Versions/3.14/bin/python3
cachedir: .pytest_cache
rootdir: /Users/galindoasc/keikichi_logistics_web/backend
plugins: asyncio-0.23.8, anyio-4.12.0
asyncio: mode=Mode.STRICT
collecting ... collected 18 items

tests/test_system_flows.py::TestSystemFlows::test_1_health_check PASSED  [  5%]
tests/test_system_flows.py::TestSystemFlows::test_2_register_client FAILED [ 11%]
tests/test_system_flows.py::TestSystemFlows::test_3_login_client FAILED  [ 16%]
tests/test_system_flows.py::TestSystemFlows::test_4_get_me FAILED        [ 22%]
tests/test_system_flows.py::TestSystemFlows::test_5_update_profile FAILED [ 27%]
tests/test_system_flows.py::TestSystemFlows::test_6_create_trip FAILED   [ 33%]
tests/test_system_flows.py::TestSystemFlows::test_7_list_trips FAILED    [ 38%]
tests/test_system_flows.py::TestSystemFlows::test_8_get_trip_detail FAILED [ 44%]
tests/test_system_flows.py::TestSystemFlows::test_9_update_trip_status FAILED [ 50%]
tests/test_system_flows.py::TestSystemFlows::test_10_bulk_delete_trips_logic_check FAILED [ 55%]
tests/test_system_flows.py::TestSystemFlows::test_11_create_reservation FAILED [ 61%]
tests/test_system_flows.py::TestSystemFlows::test_12_cancel_reservation FAILED [ 66%]
tests/test_system_flows.py::TestSystemFlows::test_13_admin_list_reservations FAILED [ 72%]
tests/test_system_flows.py::TestSystemFlows::test_14_delete_reservation FAILED [ 77%]
tests/test_system_flows.py::TestSystemFlows::test_15_get_system_config FAILED [ 83%]
tests/test_system_flows.py::TestSystemFlows::test_16_update_exchange_rate FAILED [ 88%]
tests/test_system_flows.py::TestSystemFlows::test_17_upload_document FAILED [ 94%]
tests/test_system_flows.py::TestSystemFlows::test_18_list_my_documents PASSED [100%]

=================================== FAILURES ===================================
____________________ TestSystemFlows.test_2_register_client ____________________

self = <test_system_flows.TestSystemFlows object at 0x11015b110>
client = <httpx.AsyncClient object at 0x11015ae90>

    async def test_2_register_client(self, client: AsyncClient):
        import time
        unique_str = str(int(time.time()))
        email = f"new_client_{unique_str}@example.com"
    
>       response = await client.post("/api/v1/auth/register", json={
            "email": email,
            "password": "password123",
            "full_name": "Test Client",
            "phone": "1234567890"
        })

tests/test_system_flows.py:20: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_client.py:1877: in post
    return await self.request(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_client.py:1559: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_client.py:1646: in send
    response = await self._send_handling_auth(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_client.py:1674: in _send_handling_auth
    response = await self._send_handling_redirects(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_client.py:1711: in _send_handling_redirects
    response = await self._send_single_request(request)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_client.py:1748: in _send_single_request
    response = await transport.handle_async_request(request)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_transports/asgi.py:162: in handle_async_request
    await self.app(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/applications.py:1054: in __call__
    await super().__call__(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/applications.py:123: in __call__
    await self.middleware_stack(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/middleware/cors.py:83: in __call__
    await self.app(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/middleware/exceptions.py:62: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/_exception_handler.py:64: in wrapped_app
    raise exc
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    await app(scope, receive, sender)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/routing.py:758: in __call__
    await self.middleware_stack(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/routing.py:778: in app
    await route.handle(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/routing.py:299: in handle
    await self.app(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/routing.py:79: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/_exception_handler.py:64: in wrapped_app
    raise exc
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    await app(scope, receive, sender)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/routing.py:74: in app
    response = await func(request)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/routing.py:299: in app
    raise e
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/routing.py:294: in app
    raw_response = await run_endpoint_function(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/routing.py:191: in run_endpoint_function
    return await dependant.call(**values)
app/api/v1/auth.py:19: in register
    user = await service.create_user(
app/services/user_service.py:31: in create_user
    if email and await self.get_user_by_email(email):
app/services/user_service.py:17: in get_user_by_email
    result = await self.db.execute(select(User).where(User.email == email))
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
<string>:2: in _connection_for_bind
    ???
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/orm/session.py:1187: in _connection_for_bind
    conn = bind.connect()
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:955: in connect
    await_only(creator_fn(*arg, **kw)),
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/asyncpg/connection.py:2443: in connect
    return await connect_utils._connect(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/asyncpg/connect_utils.py:1218: in _connect
    conn = await _connect_addr(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/asyncpg/connect_utils.py:1054: in _connect_addr
    return await __connect_addr(params, True, *args)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

params = ConnectionParameters(user='keikichi', password='keikichi_dev_password_2024', database='keikichi_logistics_dev', ssl=<s...postgres'>, server_settings=None, target_session_attrs=<SessionAttribute.any: 'any'>, krbsrvname=None, gsslib='gssapi')
retry = True, addr = ('127.0.0.1', 5432)
loop = <_UnixSelectorEventLoop running=False closed=False debug=False>
config = ConnectionConfiguration(command_timeout=None, statement_cache_size=100, max_cached_statement_lifetime=300, max_cacheable_statement_size=15360)
connection_class = <class 'asyncpg.connection.Connection'>
record_class = <class 'asyncpg.protocol.record.Record'>
params_input = ConnectionParameters(user='keikichi', password='keikichi_dev_password_2024', database='keikichi_logistics_dev', ssl=<s...postgres'>, server_settings=None, target_session_attrs=<SessionAttribute.any: 'any'>, krbsrvname=None, gsslib='gssapi')

    async def __connect_addr(
        params,
        retry,
        addr,
        loop,
        config,
        connection_class,
        record_class,
        params_input,
    ):
        connected = _create_future(loop)
    
        proto_factory = lambda: protocol.Protocol(
            addr, connected, params, record_class, loop)
    
        if isinstance(addr, str):
            # UNIX socket
            connector = loop.create_unix_connection(proto_factory, addr)
    
        elif params.ssl and params.ssl_negotiation is SSLNegotiation.direct:
            # if ssl and ssl_negotiation is `direct`, skip STARTTLS and perform
            # direct SSL connection
            connector = loop.create_connection(
                proto_factory, *addr, ssl=params.ssl
            )
    
        elif params.ssl:
            connector = _create_ssl_connection(
                proto_factory, *addr, loop=loop, ssl_context=params.ssl,
                ssl_is_advisory=params.sslmode == SSLMode.prefer)
        else:
            connector = loop.create_connection(proto_factory, *addr)
    
        tr, pr = await connector
    
        try:
>           await connected
E           asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "keikichi"

/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/asyncpg/connect_utils.py:1102: InvalidPasswordError
_____________________ TestSystemFlows.test_3_login_client ______________________

self = <test_system_flows.TestSystemFlows object at 0x1101862c0>
client = <httpx.AsyncClient object at 0x11015ac10>

    async def test_3_login_client(self, client: AsyncClient):
        # Relies on test_2 or we create fresh.
        # Better to be self-contained or use fixtures.
        # We will use the 'user_token' fixture for other tests,
        # here we test the endpoint failure case.
        response = await client.post("/api/v1/auth/login", data={
            "username": "nonexistent@example.com",
            "password": "wrongpassword"
        })
>       assert response.status_code in [401, 404]
E       assert 422 in [401, 404]
E        +  where 422 = <Response [422 Unprocessable Entity]>.status_code

tests/test_system_flows.py:40: AssertionError
________________________ TestSystemFlows.test_4_get_me _________________________

self = <test_system_flows.TestSystemFlows object at 0x110186520>
client = <httpx.AsyncClient object at 0x11041c8a0>, user_token = None

    async def test_4_get_me(self, client: AsyncClient, user_token):
>       assert user_token is not None
E       assert None is not None

tests/test_system_flows.py:43: AssertionError
____________________ TestSystemFlows.test_5_update_profile _____________________

self = <test_system_flows.TestSystemFlows object at 0x11017e570>
client = <httpx.AsyncClient object at 0x11041e8b0>, user_token = None

    async def test_5_update_profile(self, client: AsyncClient, user_token):
        new_phone = "9876543210"
        response = await client.put("/api/v1/users/me",
            headers={"Authorization": f"Bearer {user_token}"},
            json={"phone": new_phone}
        )
>       assert response.status_code == 200
E       assert 405 == 200
E        +  where 405 = <Response [405 Method Not Allowed]>.status_code

tests/test_system_flows.py:56: AssertionError
______________________ TestSystemFlows.test_6_create_trip ______________________

self = <test_system_flows.TestSystemFlows object at 0x110199e10>
client = <httpx.AsyncClient object at 0x1109cd250>, admin_token = None

    async def test_6_create_trip(self, client: AsyncClient, admin_token):
        trip_data = {
            "origin": "Test City A",
            "destination": "Test City B",
            "departure_date": "2025-12-25T10:00:00",
            "arrival_date": "2025-12-26T10:00:00",
            "price_per_space": 1000.0,
            "currency": "MXN",
            "total_spaces": 10,
            "is_international": False
        }
        response = await client.post("/api/v1/trips",
            headers={"Authorization": f"Bearer {admin_token}"},
            json=trip_data
        )
>       assert response.status_code == 201
E       assert 401 == 201
E        +  where 401 = <Response [401 Unauthorized]>.status_code

tests/test_system_flows.py:76: AssertionError
______________________ TestSystemFlows.test_7_list_trips _______________________

self = <test_system_flows.TestSystemFlows object at 0x110199f20>
client = <httpx.AsyncClient object at 0x1104a9260>, admin_token = None

    async def test_7_list_trips(self, client: AsyncClient, admin_token):
>       response = await client.get("/api/v1/trips",
            headers={"Authorization": f"Bearer {admin_token}"}
        )

tests/test_system_flows.py:83: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_client.py:1786: in get
    return await self.request(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_client.py:1559: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_client.py:1646: in send
    response = await self._send_handling_auth(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_client.py:1674: in _send_handling_auth
    response = await self._send_handling_redirects(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_client.py:1711: in _send_handling_redirects
    response = await self._send_single_request(request)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_client.py:1748: in _send_single_request
    response = await transport.handle_async_request(request)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/httpx/_transports/asgi.py:162: in handle_async_request
    await self.app(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/applications.py:1054: in __call__
    await super().__call__(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/applications.py:123: in __call__
    await self.middleware_stack(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/middleware/cors.py:83: in __call__
    await self.app(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/middleware/exceptions.py:62: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/_exception_handler.py:64: in wrapped_app
    raise exc
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    await app(scope, receive, sender)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/routing.py:758: in __call__
    await self.middleware_stack(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/routing.py:778: in app
    await route.handle(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/routing.py:299: in handle
    await self.app(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/routing.py:79: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/_exception_handler.py:64: in wrapped_app
    raise exc
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    await app(scope, receive, sender)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/routing.py:74: in app
    response = await func(request)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/routing.py:299: in app
    raise e
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/routing.py:294: in app
    raw_response = await run_endpoint_function(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/routing.py:191: in run_endpoint_function
    return await dependant.call(**values)
app/api/v1/trips.py:18: in list_trips
    trips = await service.list_trips(status, future_only)
app/services/trip_service.py:25: in list_trips
    result = await self.db.execute(stmt.order_by(Trip.departure_date))
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
<string>:2: in _connection_for_bind
    ???
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/orm/session.py:1187: in _connection_for_bind
    conn = bind.connect()
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:955: in connect
    await_only(creator_fn(*arg, **kw)),
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/asyncpg/connection.py:2443: in connect
    return await connect_utils._connect(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/asyncpg/connect_utils.py:1218: in _connect
    conn = await _connect_addr(
/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/asyncpg/connect_utils.py:1054: in _connect_addr
    return await __connect_addr(params, True, *args)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

params = ConnectionParameters(user='keikichi', password='keikichi_dev_password_2024', database='keikichi_logistics_dev', ssl=<s...postgres'>, server_settings=None, target_session_attrs=<SessionAttribute.any: 'any'>, krbsrvname=None, gsslib='gssapi')
retry = True, addr = ('127.0.0.1', 5432)
loop = <_UnixSelectorEventLoop running=False closed=False debug=False>
config = ConnectionConfiguration(command_timeout=None, statement_cache_size=100, max_cached_statement_lifetime=300, max_cacheable_statement_size=15360)
connection_class = <class 'asyncpg.connection.Connection'>
record_class = <class 'asyncpg.protocol.record.Record'>
params_input = ConnectionParameters(user='keikichi', password='keikichi_dev_password_2024', database='keikichi_logistics_dev', ssl=<s...postgres'>, server_settings=None, target_session_attrs=<SessionAttribute.any: 'any'>, krbsrvname=None, gsslib='gssapi')

    async def __connect_addr(
        params,
        retry,
        addr,
        loop,
        config,
        connection_class,
        record_class,
        params_input,
    ):
        connected = _create_future(loop)
    
        proto_factory = lambda: protocol.Protocol(
            addr, connected, params, record_class, loop)
    
        if isinstance(addr, str):
            # UNIX socket
            connector = loop.create_unix_connection(proto_factory, addr)
    
        elif params.ssl and params.ssl_negotiation is SSLNegotiation.direct:
            # if ssl and ssl_negotiation is `direct`, skip STARTTLS and perform
            # direct SSL connection
            connector = loop.create_connection(
                proto_factory, *addr, ssl=params.ssl
            )
    
        elif params.ssl:
            connector = _create_ssl_connection(
                proto_factory, *addr, loop=loop, ssl_context=params.ssl,
                ssl_is_advisory=params.sslmode == SSLMode.prefer)
        else:
            connector = loop.create_connection(proto_factory, *addr)
    
        tr, pr = await connector
    
        try:
>           await connected
E           asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "keikichi"

/Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/asyncpg/connect_utils.py:1102: InvalidPasswordError
____________________ TestSystemFlows.test_8_get_trip_detail ____________________

self = <test_system_flows.TestSystemFlows object at 0x11014b850>
client = <httpx.AsyncClient object at 0x1104aaf10>, admin_token = None

    async def test_8_get_trip_detail(self, client: AsyncClient, admin_token):
        # We need a trip ID. We can create one or rely on fixture.
        # Implementing a quick helper inside the test class might be messy.
        # Ideally, we'd use a fixture, but let's create one inline for clarity/isolation.
        response = await client.post("/api/v1/trips",
            headers={"Authorization": f"Bearer {admin_token}"},
            json={
                "origin": "Detail Test",
                "destination": "City",
                "departure_date": "2025-01-01T12:00:00",
                "price_per_space": 500,
                "currency": "USD"
            }
        )
>       trip_id = response.json()["id"]
E       KeyError: 'id'

tests/test_system_flows.py:103: KeyError
__________________ TestSystemFlows.test_9_update_trip_status ___________________

self = <test_system_flows.TestSystemFlows object at 0x11014b950>
client = <httpx.AsyncClient object at 0x110476250>, admin_token = None

    async def test_9_update_trip_status(self, client: AsyncClient, admin_token):
        # Create
        res = await client.post("/api/v1/trips", headers={"Authorization": f"Bearer {admin_token}"}, json={
            "origin": "Status Test", "destination": "City", "departure_date": "2025-01-01T00:00:00", "price_per_space": 500
        })
>       trip_id = res.json()["id"]
E       KeyError: 'id'

tests/test_system_flows.py:114: KeyError
____________ TestSystemFlows.test_10_bulk_delete_trips_logic_check _____________

self = <test_system_flows.TestSystemFlows object at 0x1102c19a0>
client = <httpx.AsyncClient object at 0x110476650>, admin_token = None

    async def test_10_bulk_delete_trips_logic_check(self, client: AsyncClient, admin_token):
        # Create 3 trips
        ids = []
        for i in range(3):
            res = await client.post("/api/v1/trips", headers={"Authorization": f"Bearer {admin_token}"}, json={
                "origin": f"Bulk {i}", "destination": "Dest", "departure_date": "2025-01-01T00:00:00", "price_per_space": 100
            })
>           ids.append(res.json()["id"])
E           KeyError: 'id'

tests/test_system_flows.py:130: KeyError
__________________ TestSystemFlows.test_11_create_reservation __________________

self = <test_system_flows.TestSystemFlows object at 0x1102c18b0>
client = <httpx.AsyncClient object at 0x11047cd70>, user_token = None
admin_token = None

    async def test_11_create_reservation(self, client: AsyncClient, user_token, admin_token):
        # Need a trip first
        trip_res = await client.post("/api/v1/trips", headers={"Authorization": f"Bearer {admin_token}"}, json={
            "origin": "Res Test", "destination": "City", "departure_date": "2025-01-01T00:00:00", "price_per_space": 100, "total_spaces": 10
        })
>       trip_id = trip_res.json()["id"]
E       KeyError: 'id'

tests/test_system_flows.py:149: KeyError
__________________ TestSystemFlows.test_12_cancel_reservation __________________

self = <test_system_flows.TestSystemFlows object at 0x110338750>
client = <httpx.AsyncClient object at 0x11047ce60>, user_token = None
admin_token = None

    async def test_12_cancel_reservation(self, client: AsyncClient, user_token, admin_token):
        # Setup trip and reservation
        trip_res = await client.post("/api/v1/trips", headers={"Authorization": f"Bearer {admin_token}"}, json={
            "origin": "Res Cancel", "destination": "City", "departure_date": "2025-01-01T00:00:00", "price_per_space": 100, "total_spaces": 10
        })
>       trip_id = trip_res.json()["id"]
E       KeyError: 'id'

tests/test_system_flows.py:167: KeyError
_______________ TestSystemFlows.test_13_admin_list_reservations ________________

self = <test_system_flows.TestSystemFlows object at 0x110338c90>
client = <httpx.AsyncClient object at 0x11047a6d0>, admin_token = None

    async def test_13_admin_list_reservations(self, client: AsyncClient, admin_token):
        response = await client.get("/api/v1/reservations", headers={"Authorization": f"Bearer {admin_token}"})
>       assert response.status_code == 200
E       assert 401 == 200
E        +  where 401 = <Response [401 Unauthorized]>.status_code

tests/test_system_flows.py:180: AssertionError
__________________ TestSystemFlows.test_14_delete_reservation __________________

self = <test_system_flows.TestSystemFlows object at 0x10a935640>
client = <httpx.AsyncClient object at 0x11047be70>, admin_token = None
user_token = None

    async def test_14_delete_reservation(self, client: AsyncClient, admin_token, user_token):
         # Create
        trip_res = await client.post("/api/v1/trips", headers={"Authorization": f"Bearer {admin_token}"}, json={
            "origin": "Res Del", "destination": "City", "departure_date": "2025-01-01T00:00:00", "price_per_space": 100, "total_spaces": 10
        })
        res_res = await client.post("/api/v1/reservations", headers={"Authorization": f"Bearer {user_token}"}, json={
>           "trip_id": trip_res.json()["id"], "spaces_count": 1
        })
E       KeyError: 'id'

tests/test_system_flows.py:189: KeyError
__________________ TestSystemFlows.test_15_get_system_config ___________________

self = <test_system_flows.TestSystemFlows object at 0x110173710>
client = <httpx.AsyncClient object at 0x110e5eea0>, admin_token = None

    async def test_15_get_system_config(self, client: AsyncClient, admin_token):
        response = await client.get("/api/v1/system-config", headers={"Authorization": f"Bearer {admin_token}"})
>       assert response.status_code == 200
E       assert 401 == 200
E        +  where 401 = <Response [401 Unauthorized]>.status_code

tests/test_system_flows.py:205: AssertionError
_________________ TestSystemFlows.test_16_update_exchange_rate _________________

self = <test_system_flows.TestSystemFlows object at 0x110173890>
client = <httpx.AsyncClient object at 0x111790d10>, admin_token = None

    async def test_16_update_exchange_rate(self, client: AsyncClient, admin_token):
        response = await client.post("/api/v1/system-config",
            headers={"Authorization": f"Bearer {admin_token}"},
            json={"key": "exchange_rate", "value": "20.50", "description": "Update Test"}
        )
>       assert response.status_code == 200
E       assert 405 == 200
E        +  where 405 = <Response [405 Method Not Allowed]>.status_code

tests/test_system_flows.py:215: AssertionError
___________________ TestSystemFlows.test_17_upload_document ____________________

self = <test_system_flows.TestSystemFlows object at 0x1103566d0>
client = <httpx.AsyncClient object at 0x111791490>, user_token = None

    async def test_17_upload_document(self, client: AsyncClient, user_token):
        # We need to simulate a file upload.
        # This is complex in httpx without actual file IO, but we can pass bytes.
        files = {'file': ('test.txt', b'test content', 'text/plain')}
        response = await client.post("/api/v1/documents/upload",
            headers={"Authorization": f"Bearer {user_token}"},
            data={"doc_type": "otro"},
            files=files
        )
        # Note: if it requires user_id in path or body, check router.
        # usually /api/v1/documents/upload
        if response.status_code != 200:
             # Just asserting it didn't crash 500
>            assert response.status_code in [200, 201, 400, 422]
E            assert 401 in [200, 201, 400, 422]
E             +  where 401 = <Response [401 Unauthorized]>.status_code

tests/test_system_flows.py:233: AssertionError
=============================== warnings summary ===============================
app/schemas/auth.py:45
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/auth.py:45: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class UserOut(BaseModel):

../../../../Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/routing.py:211: 273 warnings
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/routing.py:211: DeprecationWarning: 'asyncio.iscoroutinefunction' is deprecated and slated for removal in Python 3.16; use inspect.iscoroutinefunction() instead
    is_coroutine = asyncio.iscoroutinefunction(dependant.call)

app/schemas/user.py:9
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/user.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class UserBase(BaseModel):

app/schemas/user.py:31
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/user.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class UserResponse(UserBase):

app/schemas/user.py:77
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/user.py:77: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    @validator('email', 'phone')

../../../../Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi_mail/schemas.py:91
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi_mail/schemas.py:91: PydanticDeprecatedSince212: Using `@model_validator` with mode='after' on a classmethod is deprecated. Instead, use an instance method. See the documentation at https://docs.pydantic.dev/2.12/concepts/validators/#model-after-validator. Deprecated in Pydantic V2.12 to be removed in V3.0.
    @model_validator(mode="after")

app/schemas/trip.py:70
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/trip.py:70: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TripOut(TripBase):

app/schemas/space.py:10
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/space.py:10: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class SpaceBase(BaseModel):

app/schemas/reservation.py:27
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/reservation.py:27: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class HoldSpacesResponse(BaseModel):

app/schemas/reservation.py:64
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/reservation.py:64: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LoadItemResponse(LoadItemCreate):

app/schemas/reservation.py:152
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/reservation.py:152: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ReservationSpaceDetail(BaseModel):

app/schemas/reservation.py:162
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/reservation.py:162: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ReservationTripDetail(BaseModel):

app/schemas/reservation.py:178
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/reservation.py:178: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ReservationResponse(BaseModel):

app/schemas/reservation.py:243
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/reservation.py:243: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ReservationListItem(BaseModel):

app/schemas/label_price.py:18
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/label_price.py:18: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LabelPriceOut(LabelPriceBase):

app/api/v1/system_config.py:28
  /Users/galindoasc/keikichi_logistics_web/backend/app/api/v1/system_config.py:28: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class SystemConfigResponse(SystemConfigBase):

app/schemas/client_document.py:24
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/client_document.py:24: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ClientDocumentOut(ClientDocumentBase):

app/schemas/catalog.py:17
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/catalog.py:17: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Product(ProductBase):

app/schemas/catalog.py:35
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/catalog.py:35: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Unit(UnitBase):

app/schemas/notification.py:25
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/notification.py:25: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class NotificationResponse(NotificationBase):

app/schemas/fleet.py:22
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/fleet.py:22: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FleetDriverOut(FleetDriverBase):

app/schemas/fleet.py:49
  /Users/galindoasc/keikichi_logistics_web/backend/app/schemas/fleet.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FleetVehicleOut(FleetVehicleBase):

app/main.py:42
  /Users/galindoasc/keikichi_logistics_web/backend/app/main.py:42: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

../../../../Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/applications.py:4495
../../../../Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/applications.py:4495
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

app/main.py:82
  /Users/galindoasc/keikichi_logistics_web/backend/app/main.py:82: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("shutdown")

../../../../Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py:169: 598 warnings
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py:169: DeprecationWarning: 'asyncio.iscoroutinefunction' is deprecated and slated for removal in Python 3.16; use inspect.iscoroutinefunction() instead
    return asyncio.iscoroutinefunction(obj) or inspect.isasyncgenfunction(obj)

../../../../Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py:433: 18 warnings
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py:433: DeprecationWarning: 'asyncio.iscoroutinefunction' is deprecated and slated for removal in Python 3.16; use inspect.iscoroutinefunction() instead
    return asyncio.iscoroutinefunction(func)

tests/test_system_flows.py::TestSystemFlows::test_1_health_check
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py:1005: DeprecationWarning: 'asyncio.get_event_loop_policy' is deprecated and slated for removal in Python 3.16
    return asyncio.get_event_loop_policy()

tests/test_system_flows.py: 18 warnings
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py:751: DeprecationWarning: 'asyncio.get_event_loop_policy' is deprecated and slated for removal in Python 3.16
    _restore_event_loop_policy(asyncio.get_event_loop_policy()),

tests/test_system_flows.py: 18 warnings
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py:977: DeprecationWarning: 'asyncio.set_event_loop_policy' is deprecated and slated for removal in Python 3.16
    asyncio.set_event_loop_policy(new_loop_policy)

tests/test_system_flows.py: 18 warnings
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py:978: DeprecationWarning: 'asyncio.get_event_loop_policy' is deprecated and slated for removal in Python 3.16
    loop = asyncio.get_event_loop_policy().new_event_loop()

tests/test_system_flows.py: 18 warnings
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py:766: DeprecationWarning: 'asyncio.get_event_loop_policy' is deprecated and slated for removal in Python 3.16
    policy = asyncio.get_event_loop_policy()

tests/test_system_flows.py: 52 warnings
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/starlette/_utils.py:42: DeprecationWarning: 'asyncio.iscoroutinefunction' is deprecated and slated for removal in Python 3.16; use inspect.iscoroutinefunction() instead
    return asyncio.iscoroutinefunction(obj) or (

tests/test_system_flows.py: 18 warnings
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py:811: DeprecationWarning: 'asyncio.get_event_loop_policy' is deprecated and slated for removal in Python 3.16
    policy = asyncio.get_event_loop_policy()

tests/test_system_flows.py: 18 warnings
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py:835: DeprecationWarning: 'asyncio.set_event_loop_policy' is deprecated and slated for removal in Python 3.16
    asyncio.set_event_loop_policy(previous_policy)

tests/test_system_flows.py: 18 warnings
  /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/site-packages/pytest_asyncio/plugin.py:847: DeprecationWarning: 'asyncio.get_event_loop_policy' is deprecated and slated for removal in Python 3.16
    policy = asyncio.get_event_loop_policy()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_system_flows.py::TestSystemFlows::test_2_register_client - ...
FAILED tests/test_system_flows.py::TestSystemFlows::test_3_login_client - ass...
FAILED tests/test_system_flows.py::TestSystemFlows::test_4_get_me - assert No...
FAILED tests/test_system_flows.py::TestSystemFlows::test_5_update_profile - a...
FAILED tests/test_system_flows.py::TestSystemFlows::test_6_create_trip - asse...
FAILED tests/test_system_flows.py::TestSystemFlows::test_7_list_trips - async...
FAILED tests/test_system_flows.py::TestSystemFlows::test_8_get_trip_detail - ...
FAILED tests/test_system_flows.py::TestSystemFlows::test_9_update_trip_status
FAILED tests/test_system_flows.py::TestSystemFlows::test_10_bulk_delete_trips_logic_check
FAILED tests/test_system_flows.py::TestSystemFlows::test_11_create_reservation
FAILED tests/test_system_flows.py::TestSystemFlows::test_12_cancel_reservation
FAILED tests/test_system_flows.py::TestSystemFlows::test_13_admin_list_reservations
FAILED tests/test_system_flows.py::TestSystemFlows::test_14_delete_reservation
FAILED tests/test_system_flows.py::TestSystemFlows::test_15_get_system_config
FAILED tests/test_system_flows.py::TestSystemFlows::test_16_update_exchange_rate
FAILED tests/test_system_flows.py::TestSystemFlows::test_17_upload_document
================= 16 failed, 2 passed, 1093 warnings in 0.51s ==================
Task was destroyed but it is pending!
task: <Task pending name='Task-6' coro=<<async_generator_athrow without __name__>()> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/tasks.py:991, Task.task_wakeup()]>>
Task was destroyed but it is pending!
task: <Task pending name='Task-11' coro=<<async_generator_athrow without __name__>()> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/tasks.py:991, Task.task_wakeup()]>>
Task was destroyed but it is pending!
task: <Task pending name='Task-25' coro=<<async_generator_athrow without __name__>()> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/tasks.py:991, Task.task_wakeup()]>>
Task was destroyed but it is pending!
task: <Task pending name='Task-31' coro=<<async_generator_athrow without __name__>()> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/tasks.py:991, Task.task_wakeup()]>>
Task was destroyed but it is pending!
task: <Task pending name='Task-37' coro=<<async_generator_athrow without __name__>()> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/tasks.py:991, Task.task_wakeup()]>>
Task was destroyed but it is pending!
task: <Task pending name='Task-43' coro=<<async_generator_athrow without __name__>()> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/tasks.py:991, Task.task_wakeup()]>>
Task was destroyed but it is pending!
task: <Task pending name='Task-49' coro=<<async_generator_athrow without __name__>()> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/tasks.py:991, Task.task_wakeup()]>>
Task was destroyed but it is pending!
task: <Task pending name='Task-56' coro=<<async_generator_athrow without __name__>()> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/tasks.py:991, Task.task_wakeup()]>>
Task was destroyed but it is pending!
task: <Task pending name='Task-63' coro=<<async_generator_athrow without __name__>()> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/tasks.py:991, Task.task_wakeup()]>>
Task was destroyed but it is pending!
task: <Task pending name='Task-69' coro=<<async_generator_athrow without __name__>()> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/tasks.py:991, Task.task_wakeup()]>>
Task was destroyed but it is pending!
task: <Task pending name='Task-76' coro=<<async_generator_athrow without __name__>()> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/tasks.py:991, Task.task_wakeup()]>>
Task was destroyed but it is pending!
task: <Task pending name='Task-93' coro=<<async_generator_athrow without __name__>()> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Library/Frameworks/Python.framework/Versions/3.14/lib/python3.14/asyncio/tasks.py:991, Task.task_wakeup()]>>
